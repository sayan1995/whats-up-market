var pixel={pixelConfig:null,initialize:null,finalize:null,paramArray:[],pageLoadStatusFlag:false,checkReadyStateOnIntervals:null,pixelFireStatus:false,baseUrl:null,parse:function(){try{pixel.checkReadyStateOnIntervals=setInterval(function(){pixel.checkIfPageLoadComplete();if(pixel.pageLoadStatusFlag===true){try{pixel.initialize();pixel.getParams();pixel.finalize();}catch(d){pixel.paramArray.param="999";var e=pixel.getQueryString(pixel.paramArray);var f=pixel.baseUrl+e;pixel.createIframe(f);}}},3000,"Javascript");}catch(a){pixel.paramArray.param="999";var b=pixel.getQueryString(pixel.paramArray);var c=pixel.baseUrl+b;pixel.createIframe(c);}},checkIfPageLoadComplete:function(){if(document.readyState==="interactive"||document.readyState==="complete"){pixel.pageLoadStatusFlag=true;clearInterval(pixel.checkReadyStateOnIntervals);}else{pixel.pageLoadStatusFlag=false;}},getParams:function(){var b="",a="",c="";for(var d in pixel.pixelConfig){if(pixel.pixelConfig[d]!=undefined&&pixel.pixelConfig[d]!=""){b=pixel.pixelConfig[d][1];a=pixel.pixelConfig[d][0];c=pixel.pixelConfig[d][2];}if(b!=undefined&&b!=""){if(b==="xpath"&&a!=""&&a!=undefined){pixel.paramArray[d]=pixel.getDataFromXPath(a,c);}else{if(b==="url"&&c!=""&&a!=""&&a!=undefined&&c!=undefined){pixel.paramArray[d]=pixel.getDataFromUrl(a,c);}}}}},getDataFromXPath:function(h,k){var g=[],q=[],a=[];var f="",n="",j="",m="";var v="",j="";var e="",d="",b="",o=0;var l=document.getElementsByTagName("body")[0];var c="undefined";var u=true;n=h.replace("/html/body/","");if(h.indexOf('@id="')!==-1){g=h.match(/.*\[@id="(.+)"\].*/);if(typeof g!=="undefined"&&g!==null&&g.length>=1){f=g[1];}}if(typeof f!=="undefined"&&f!==null&&f!==""){l=document.getElementById(f);var t='/*[@id="'+f+'"]/';var s='//*[@id="'+f+'"]/';var p='//*[@id="'+f+'"]';var r='*//*[@id="'+f+'"]/';n=n.replace(r,"");n=n.replace(s,"");n=n.replace(t,"");n=n.replace(p,"");}if(typeof n==="undefined"||n===null||n===""){l=document.getElementById(f);}else{q=n.split("/");for(o=0;o<q.length;o++){if(typeof q[o]!=="undefined"&&q[o]!==null){a=q[o].match(/(\w*)(\[(\d+)\])?/);if(typeof a!=="undefined"&&a!==null){v=a[1];j=1;if(a.length>=3&&a[3]!=undefined&&a[3]!=""){j=a[3];}}}if(typeof l!==c&&l!==null&&l!="No Data"){l=pixel.getCurrentNode(l,v,j);}else{u=false;break;}}}if(typeof l!==c&&l!==null&&u&&l!="No Data"){if(k===""||k===null||k==undefined){if(typeof l.innerHTML!==c&&l.innerHTML!==null){m=l.innerHTML;}}else{if(typeof l.getAttribute(k)!==c&&l.getAttribute(k)!==null){m=l.getAttribute(k);}}return pixel.removeJunk(m);}else{return"";}},removeJunk:function(a){if(typeof a!=="undefined"&&a!=null&&a!==""){a=a.toString();a=a.replace(/(^\s*)|(\s*$)/gi,"");a=a.replace(/[ ]{2,}/gi," ");a=a.replace(/\n /,"\n");a=a.replace(/<.*?>/g,"");a=a.replace(/[ \t\r\n]+/g," ");a=a.replace(/^\s+|\s+$/g,"");a=a.replace(/&amp;/g,"&");return a;}return"";},getCurrentNode:function(f,c,g){var b="No Data";var a=1,e=0;var d="undefined";if(typeof f.childNodes!==d&&f.childNodes!==null){var h=f.childNodes;for(a=0;a<=h.length;a++){if(typeof h[a]!==d&&h[a]!==null&&typeof h[a].tagName!==d&&h[a].tagName!==null&&h[a].tagName.toLowerCase()===c){e++;}if(e==g){b=h[a];break;}}return b;}else{return null;}},getDataFromUrl:function(d,c){var b=null,a=document.URL;c=parseInt(c);b=a.match(d);if(b!=undefined&&b!=null&&b!=""&&b[c]!=undefined){if(c>=0){return b[c];}else{c=Math.abs(c);return b[b.length-c];}}return"";},getParamFromUrl:function(c,e){var d=new RegExp("(?:\\?|&)"+e+"=(.*?)(?=&|$)","gi");var b=[],a;while((a=d.exec(c))!=null){b[b.length]=a[1];}if(b.length!==0){return b[0];}return"";},createIframe:function(c){if(!(pixel.pixelFireStatus)){var b=document.createElement("iframe");b.src=c;b.scrolling="no";b.width=1;b.height=1;b.marginheight=0;b.marginwidth=0;b.frameborder=0;b.style.display="none";pixel.pixelFireStatus=true;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a);}},validateParams:function(a,e,d,c,b){var f=a.segment;var k=f.substring(0,1);var j=a[e];var i=a[d];var h=a[c];var g=a[b];switch(k){case"t":if(j==undefined||j==""||i==undefined||i==""){a.section=1;a.level=2;a.param="t100";}break;default:if((j==undefined||j=="")&&(i==undefined||i=="")&&(h==undefined||h=="")&&(g==undefined||g=="")){a.section=1;a.level=2;a.param=k+"100";}break;}return a;},paramChange:function(a){if(a!==null&&a!=="undefined"){a=a.toString();a=a.replace(/<.*?>/g,"");a=a.replace(/[ \t\r\n]+/g," ");a=a.replace(/^\s+|\s+$/g,"");a=a.replace(/&amp;/g,"&");a=encodeURIComponent(encodeURIComponent(a));return a;}return"";},getQueryString:function(a){var c=a.account_id;var e="?account_id="+c;delete a.account_id;var d="";for(var b in a){if(a.hasOwnProperty(b)){d=a[b];e+="&"+b+"="+pixel.paramChange(d);}}return e;}};var config_e300={pid:['//*[@id="id-product-id"]',"xpath","value"],pname:['//*[@id="uiv2-product-caption"]',"xpath",""],lp:["([^?]*)","url","1"],catid:['//*[@id="uiv2-shopping-list"]/div[1]/div[2]/a/span',"xpath",""],subcat1id:['//*[@id="uiv2-shopping-list"]/div[1]/div[3]/a/span',"xpath",""]};var config_e205={catid1:['//*[@id="filter-bar-container"]/div/div[2]/a',"xpath",""]};var config_e200={catid:["/html/body/div[16]/div[3]/div[2]/div[2]/a/span","xpath",""],subcat1id:["/html/body/div[16]/div[3]/div[2]/div[3]/a/span","xpath",""]};pixel.baseUrl=("https:"==document.location.protocol?"https://ssl":"http://serv3")+".vizury.com/analyze/analyze.php";pixel.initialize=function(){var b=document.URL;pixel.paramArray.account_id="VIZVRM1948";pixel.paramArray.level=pixel.paramArray.section="1";var a="";if(b.match(/https?:\/\/bigbasket\.com\/basket/i)!==null){pixel.paramArray.param="e400";}else{if(b.match(/https?:\/\/bigbasket\.com\/pd\/[0-9]+\/.*/i)!==null){pixel.paramArray.param="e300";pixel.pixelConfig=config_e300;}else{if((a=b.match(/https?:\/\/bigbasket\.com\/ps\/\?q=([^\&]+)/i))!==null){pixel.paramArray.param="e205";pixel.pixelConfig=config_e205;pixel.paramArray.firstCat=a[1];}else{if((a=b.match(/https?:\/\/bigbasket\.com\/((pc)|(cl)|(promo)|(products)|(backtoschool))\/.+/i))!==null){pixel.paramArray.param="e200";if(a[1].toLowerCase()==="backtoschool"){pixel.paramArray.catid="backtoschool";pixel.paramArray.level="5";}else{pixel.pixelConfig=config_e200;if(a[1].toLowerCase()==="promo"){pixel.paramArray.level=pixel.paramArray.section="2";pixel.pixelConfig=null;pixel.paramArray.catid="PROMOTIONS";}else{if(a[1].toLowerCase()==="cl"){pixel.paramArray.level="2";}}}}else{pixel.paramArray.param="e100";}}}}};pixel.finalize=function(){var c="",f="",k=0;switch(pixel.paramArray.param){case"e300":if(pixel.paramArray.pid!==""){c=document.getElementById("slidingProduct"+pixel.paramArray.pid);if(c!==null){f=c.getElementsByTagName("div");for(k=0;k<f.length;k++){if(typeof f[k]!=="undefined"){if(f[k].className==="uiv2-price"){pixel.paramArray["new"]=f[k].innerHTML;}else{if(f[k].className==="uiv2-brand-name"){pixel.paramArray.subcat2id=pixel.removeJunk(f[k].innerHTML);}}}if(typeof pixel.paramArray["new"]!=="undefined"&&typeof pixel.paramArray.subcat2id!=="undefined"){break;}}}pixel.paramArray.old=pixel.getDataFromXPath('//*[@id="uiv2-mrp"]',"").replace(/(^[^0-9]*)|[^0-9.]/g,"");pixel.paramArray.misc=pixel.paramArray["new"].replace(/[0-9.]/g,"");pixel.paramArray["new"]=pixel.paramArray["new"].replace(/(^[^0-9]*)|[^0-9.]/g,"");pixel.paramArray.image=pixel.getDataFromXPath('//*[@id="pimg_'+pixel.paramArray.pid+'"]',"src");if(pixel.paramArray.image!==""&&pixel.paramArray.image.indexOf("http")!==0){pixel.paramArray.image=document.location.protocol+pixel.paramArray.image;}c=document.getElementById("carouSlide_1");if(c!==null){pixel.paramArray.misc1="";c=c.getElementsByTagName("li");for(k=0;k<c.length;k++){if(typeof c[k]!=="undefined"&&c[k].getAttribute("name")!==null){if(pixel.paramArray.misc1!==""){pixel.paramArray.misc1=pixel.paramArray.misc1+","+c[k].getAttribute("name").replace(/[^0-9]/g,"");}else{pixel.paramArray.misc1=c[k].getAttribute("name").replace(/[^0-9]/g,"");}}}}}break;case"e200":if(pixel.paramArray.subcat1id===""&&pixel.paramArray.level=="1"&&pixel.paramArray.section=="1"){switch(pixel.paramArray.catid.toLowerCase()){case"discounts":pixel.paramArray.section="2";break;case"bundle pack products":pixel.paramArray.level="3";pixel.paramArray.section="2";break;case"new launches":pixel.paramArray.level="4";break;case"now at bigbasket":pixel.paramArray.level="3";}}break;case"e205":if(pixel.paramArray.catid1!==""){pixel.paramArray.catid1=pixel.paramArray.firstCat+"_"+pixel.paramArray.catid1;}else{pixel.paramArray.catid1=pixel.paramArray.firstCat;}delete pixel.paramArray.firstCat;break;case"e400":var e=[],b=[],a=[];f=document.getElementsByTagName("div");pixel.paramArray.pid1=pixel.paramArray.pid2=pixel.paramArray.pid3="";for(var h=f.length-1;h>=0;h--){if(typeof f[h]!=="undefined"&&f[h].className==="uiv2-yourbasketitems-gridlist"){c=f[h].getElementsByTagName("div");for(k=0;k<c.length;k++){if(typeof c[k]!=="undefined"&&typeof c[k].id!=="undefined"&&c[k].className==="row"){if(pixel.paramArray.pid1===""){pixel.paramArray.pid1=c[k].id.replace(/[^0-9]/g,"");}else{if(pixel.paramArray.pid2===""){pixel.paramArray.pid2=c[k].id.replace(/[^0-9]/g,"");}else{if(pixel.paramArray.pid3===""){pixel.paramArray.pid3=c[k].id.replace(/[^0-9]/g,"");}else{break;}}}}}c=f[h].getElementsByTagName("h4");for(k=0;k<c.length;k++){if(typeof c[k]!=="undefined"&&typeof c[k].getElementsByTagName("span")[0]!=="undefined"){if(e.length===0){e=c[k].getElementsByTagName("span")[0].innerHTML.split(":");}else{if(b.length===0){b=c[k].getElementsByTagName("span")[0].innerHTML.split(":");}else{if(a.length===0){a=c[k].getElementsByTagName("span")[0].innerHTML.split(":");}else{break;}}}}}break;}}if(e.length===2){pixel.paramArray.quantity1=e[0].replace(/[^0-9]/g,"");pixel.paramArray.price1=e[1].replace(/(^[^0-9]*)|[^0-9.]/g,"");}if(b.length===2){pixel.paramArray.quantity2=b[0].replace(/[^0-9]/g,"");pixel.paramArray.price2=b[1].replace(/(^[^0-9]*)|[^0-9.]/g,"");}if(a.length===2){pixel.paramArray.quantity3=a[0].replace(/[^0-9]/g,"");pixel.paramArray.price3=a[1].replace(/(^[^0-9]*)|[^0-9.]/g,"");}}var g=pixel.getQueryString(pixel.paramArray);var d=pixel.baseUrl+g;pixel.createIframe(d);};